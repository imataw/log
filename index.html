<!-- 前面的代码保持不变 -->
<script>
    // 从配置文件中获取 CLIENT_ID
    async function getConfig() {
        try {
            const response = await fetch('config.json');
            const config = await response.json();
            return config;
        } catch (error) {
            console.error('Error loading config:', error);
            return null;
        }
    }

    let CLIENT_ID = ''; // 将从配置文件加载
    const REPO_OWNER = 'imataw';
    const REPO_NAME = 'log';
    let accessToken = null;

    // 修改登录函数
    async function login() {
        if (!CLIENT_ID) {
            const config = await getConfig();
            if (!config) {
                alert('无法加载配置');
                return;
            }
            CLIENT_ID = config.client_id;
        }

        const state = Math.random().toString(36).substring(7);
        sessionStorage.setItem('oauth_state', state);
        const authUrl = `https://github.com/login/oauth/authorize?` +
            `client_id=${CLIENT_ID}` +
            `&redirect_uri=${window.location.origin}/log/callback.html` +
            `&scope=repo` +
            `&state=${state}`;
        window.location.href = authUrl;
    }

    // 其他代码保持不变...
</script>
