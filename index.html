<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>想法分享</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --border-color: #ddd;
            --input-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --border-color: #404040;
            --input-bg: #2d2d2d;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: var(--text-color);
        }

        textarea {
            width: 100%;
            height: 150px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .idea-list {
            margin-top: 20px;
        }

        .idea-item {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .header-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .settings-btn, .theme-btn {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: var(--text-color);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            margin-bottom: 40px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 2.5em;
            color: var(--text-color);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .settings-section {
            background: var(--input-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-color);
            margin-bottom: 30px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .settings-section.visible {
            display: block;
        }

        .settings-section h3 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .form-group input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group input[type="number"] {
            width: 120px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .publish-section {
            background: var(--input-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-color);
            margin-bottom: 30px;
            position: relative;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-color);
        }

        textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .ideas-section {
            margin-top: 40px;
        }

        .ideas-section h2 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 600;
        }

        .idea-card {
            background: var(--input-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-color);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .idea-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
        }

        .idea-card p {
            color: var(--text-color);
            margin-bottom: 15px;
            font-size: 16px;
            line-height: 1.6;
        }

        .idea-card .timestamp {
            color: #95a5a6;
            font-size: 0.9em;
            font-weight: 500;
        }

        .token-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-password {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            color: var(--text-color);
        }

        .toggle-password:hover {
            opacity: 0.8;
        }

        .input-toolbar {
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
        }

        .jp-keyboard-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-color);
            transition: all 0.2s;
        }

        .jp-keyboard-btn:hover {
            background: var(--border-color);
        }

        .jp-keyboard {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-top: 8px;
            padding: 12px;
            display: none;
            z-index: 1000;
        }

        .jp-keyboard-row {
            display: flex;
            gap: 4px;
            margin-bottom: 4px;
        }

        .jp-keyboard-row:last-child {
            margin-bottom: 0;
        }

        .jp-key {
            padding: 8px;
            min-width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
            transition: all 0.2s;
            position: relative;
        }

        .jp-key:hover {
            background: #f5f5f5;
        }

        .jp-key.wide {
            min-width: 70px;
        }

        .jp-key.extra-wide {
            min-width: 90px;
        }

        .jp-key.space {
            min-width: 400px;
        }

        .jp-key .sub {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            color: #666;
        }

        .jp-keyboard-modes {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #ddd;
        }

        .jp-keyboard-mode {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        .jp-keyboard-mode input[type="radio"] {
            margin: 0;
        }

        [data-theme='dark'] .jp-keyboard {
            background: var(--input-bg);
            border-color: var(--border-color);
        }

        [data-theme='dark'] .jp-key {
            background: var(--input-bg);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        [data-theme='dark'] .jp-key:hover {
            background: var(--border-color);
        }

        [data-theme='dark'] .jp-key .sub {
            color: var(--text-color);
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>想法分享</h1>
            <div class="header-buttons">
                <button class="theme-btn" onclick="toggleTheme()" title="切换主题">
                    <svg class="theme-icon" viewBox="0 0 24 24" width="16" height="16">
                        <path class="sun-icon" fill="currentColor" d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                        <path class="moon-icon" fill="currentColor" style="display:none" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm0-1a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/>
                    </svg>
                </button>
                <button class="settings-btn" onclick="toggleSettings()" title="设置">
                    <svg viewBox="0 0 16 16" width="16" height="16">
                        <path fill="currentColor" d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.038.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.211.224l-.29 1.106c-.168.646-.715 1.196-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.064-1.289-.614-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.224a5.738 5.738 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.12 8.12 0 0 1-.704-1.218c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.214 6.214 0 0 1 0-.772c.01-.147-.038-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.211-.224l.29-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.105c-.147.561-.549.967-.998 1.189-.173.086-.34.183-.5.29-.417.278-.97.423-1.529.27l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.411.406.562.957.53 1.456a4.709 4.709 0 0 0 0 .582c.032.499-.119 1.05-.53 1.456l-.815.806c-.081.08-.073.159-.059.19a6.464 6.464 0 0 1-.573-.989c-.02-.03-.085-.076-.195-.046l-1.102.303c-.56.153-1.113.008-1.53.27a4.44 4.44 0 0 0-.501.29c-.447.222-.85.629-.997 1.189l-.289-1.106c-.029-.11-.101-.143-.137-.146a6.6 6.6 0 0 1 1.142 0c.036.003.108.036.137.146l.289 1.105c.147.561.549.967.998 1.189.173.086.34.183.5.29.417.278.97.423 1.529.27l1.103-.303c.109-.029.175.016.195.045.22-.313.412-.644.573-.99.014-.031.021-.11-.059-.19l-.815-.806c-.411-.406-.562-.957-.53-1.456a4.709 4.709 0 0 0 0-.582c-.032-.499.119-1.05.53-1.456l.815-.806c.081-.08.073-.159.059-.19a6.464 6.464 0 0 1 .573-.989c.02-.03.085-.076.195-.046l1.102.303c.56.153 1.113.008 1.53.27a4.44 4.44 0 0 0 .501.29c.447.222.85.629.997 1.189l.289 1.106c.029.11.101.143.137.146a6.6 6.6 0 0 1-1.142 0ZM8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm0-1a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/>
                    </svg>
                </button>
            </div>
        </header>

        <div class="settings-section" id="settingsSection">
            <h3>GitHub 设置</h3>
            <div class="form-group">
                <label for="githubToken">GitHub Token</label>
                <div class="token-input-group">
                    <input type="password" id="githubToken" placeholder="输入你的GitHub Token">
                    <button class="toggle-password" type="button" title="显示/隐藏">
                        <svg class="eye-icon" viewBox="0 0 16 16" width="16" height="16">
                            <path class="eye-open" fill="currentColor" d="M8 2c1.981 0 3.671.992 4.933 2.078 1.27 1.091 2.187 2.345 2.637 3.023a1.62 1.62 0 0 1 0 1.798c-.45.678-1.367 1.932-2.637 3.023C11.67 13.008 9.981 14 8 14c-1.981 0-3.671-.992-4.933-2.078C1.797 10.83.88 9.576.43 8.898a1.62 1.62 0 0 1 0-1.798c.45-.677 1.367-1.931 2.637-3.022C4.33 2.992 6.019 2 8 2ZM1.679 7.932a.12.12 0 0 0 0 .136c.411.622 1.241 1.75 2.366 2.717C5.176 11.758 6.527 12.5 8 12.5c1.473 0 2.825-.742 3.955-1.715 1.124-.967 1.954-2.096 2.366-2.717a.12.12 0 0 0 0-.136c-.412-.621-1.242-1.75-2.366-2.717C10.824 4.242 9.473 3.5 8 3.5c-1.473 0-2.825.742-3.955 1.715-1.124.967-1.954 2.096-2.366 2.717ZM8 10a2 2 0 1 1-.001-3.999A2 2 0 0 1 8 10Z"></path>
                            <path class="eye-closed" fill="currentColor" style="display:none" d="M3.98 2.47a.75.75 0 0 1 .98-.06l.09.06 10.29 10.3a.75.75 0 0 1-.98 1.14l-.09-.06-2.25-2.25a9.06 9.06 0 0 1-2.86 1.25c-.1.02-.13.02-.17.02H8c-1.98 0-3.67-.99-4.93-2.08C1.8 9.73.88 8.48.43 7.8a1.62 1.62 0 0 1 0-1.8c.45-.67 1.37-1.92 2.637-3.02a7.97 7.97 0 0 1 1.17-.82L3.03 1.03a.75.75 0 0 1 .95-1.1Zm1.27 3.73-1.2 1.2c-.38.3-.72.64-1.02.98C2.92 9.07 7.07 11.2 8 11.2c.14 0 .3-.02.43-.05l-1.22-1.22a2 2 0 0 1-2.7-2.7l.74-.73ZM8 2c-.17 0-.34.01-.51.03L6.09 3.43c.55-.22 1.22-.33 1.91-.33 1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.12.12 0 0 1 0 .136c-.241.364-.588.775-.99 1.19l1.05 1.05c.47-.47.89-.97 1.23-1.41a1.62 1.62 0 0 0 0-1.798c-.45-.678-1.37-1.932-2.637-3.023C11.67 2.992 9.981 2 8 2Z M6.75 6.72l2.54 2.54a2 2 0 0 0-2.54-2.54Z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="form-group">
                <label for="tokenExpiration">Token 过期时间（分钟）</label>
                <input type="number" id="tokenExpiration" min="1">
            </div>
            <button class="save-settings" onclick="saveToken()">保存设置</button>
            <div id="tokenStatus" class="status"></div>
        </div>
        
        <main>
            <section class="publish-section">
                <div class="input-toolbar">
                    <button class="jp-keyboard-btn" onclick="toggleJapaneseKeyboard()" title="日语键盘">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M20,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4M4.5,9H6.5V11H4.5V9M8,9H10V11H8V9M11.5,9H13.5V11H11.5V9M15,9H17V11H15V9M18.5,9H20.5V11H18.5V9M4.5,13H6.5V15H4.5V13M8,13H10V15H8V13M11.5,13H13.5V15H11.5V13M15,13H17V15H15V13M18.5,13H20.5V15H18.5V13Z"/>
                    </svg>
                    あ
                </button>
            </div>
            <div class="jp-keyboard">
                <div id="hiraganaKeyboard">
                    <div class="jp-keyboard-row">
                        <div class="jp-key" onclick="insertJapaneseChar('ろ')"><span class="sub">1</span>ろ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ぬ')"><span class="sub">2</span>ぬ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ふ')"><span class="sub">3</span>ふ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('あ')"><span class="sub">4</span>あ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('う')"><span class="sub">5</span>う</div>
                        <div class="jp-key" onclick="insertJapaneseChar('え')"><span class="sub">6</span>え</div>
                        <div class="jp-key" onclick="insertJapaneseChar('お')"><span class="sub">7</span>お</div>
                        <div class="jp-key" onclick="insertJapaneseChar('や')"><span class="sub">8</span>や</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ゆ')"><span class="sub">9</span>ゆ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('よ')"><span class="sub">0</span>よ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('わ')"><span class="sub">-</span>わ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ほ')"><span class="sub">=</span>ほ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('へ')"><span class="sub">\</span>へ</div>
                        <div class="jp-key wide">Backspace</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key wide">Tab</div>
                        <div class="jp-key" onclick="insertJapaneseChar('た')"><span class="sub">q</span>た</div>
                        <div class="jp-key" onclick="insertJapaneseChar('て')"><span class="sub">w</span>て</div>
                        <div class="jp-key" onclick="insertJapaneseChar('い')"><span class="sub">e</span>い</div>
                        <div class="jp-key" onclick="insertJapaneseChar('す')"><span class="sub">r</span>す</div>
                        <div class="jp-key" onclick="insertJapaneseChar('か')"><span class="sub">t</span>か</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ん')"><span class="sub">y</span>ん</div>
                        <div class="jp-key" onclick="insertJapaneseChar('な')"><span class="sub">u</span>な</div>
                        <div class="jp-key" onclick="insertJapaneseChar('に')"><span class="sub">i</span>に</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ら')"><span class="sub">o</span>ら</div>
                        <div class="jp-key" onclick="insertJapaneseChar('せ')"><span class="sub">p</span>せ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('゛')"><span class="sub">[</span>゛</div>
                        <div class="jp-key" onclick="insertJapaneseChar('゜')"><span class="sub">]</span>゜</div>
                        <div class="jp-key" onclick="insertJapaneseChar('む')">む</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key extra-wide">Caps Lock</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ち')"><span class="sub">a</span>ち</div>
                        <div class="jp-key" onclick="insertJapaneseChar('と')"><span class="sub">s</span>と</div>
                        <div class="jp-key" onclick="insertJapaneseChar('し')"><span class="sub">d</span>し</div>
                        <div class="jp-key" onclick="insertJapaneseChar('は')"><span class="sub">f</span>は</div>
                        <div class="jp-key" onclick="insertJapaneseChar('き')"><span class="sub">g</span>き</div>
                        <div class="jp-key" onclick="insertJapaneseChar('く')"><span class="sub">h</span>く</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ま')"><span class="sub">j</span>ま</div>
                        <div class="jp-key" onclick="insertJapaneseChar('の')"><span class="sub">k</span>の</div>
                        <div class="jp-key" onclick="insertJapaneseChar('り')"><span class="sub">l</span>り</div>
                        <div class="jp-key" onclick="insertJapaneseChar('れ')"><span class="sub">;</span>れ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('け')"><span class="sub">'</span>け</div>
                        <div class="jp-key extra-wide">Enter</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key extra-wide">Shift</div>
                        <div class="jp-key" onclick="insertJapaneseChar('つ')"><span class="sub">z</span>つ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('さ')"><span class="sub">x</span>さ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('そ')"><span class="sub">c</span>そ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ひ')"><span class="sub">v</span>ひ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('こ')"><span class="sub">b</span>こ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('み')"><span class="sub">n</span>み</div>
                        <div class="jp-key" onclick="insertJapaneseChar('も')"><span class="sub">m</span>も</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ね')"><span class="sub">,</span>ね</div>
                        <div class="jp-key" onclick="insertJapaneseChar('る')"><span class="sub">.</span>る</div>
                        <div class="jp-key" onclick="insertJapaneseChar('め')"><span class="sub">/</span>め</div>
                        <div class="jp-key extra-wide">Shift</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key">A/あ</div>
                        <div class="jp-key wide">Alt</div>
                        <div class="jp-key space" onclick="insertJapaneseChar(' ')">Space</div>
                        <div class="jp-key wide">Alt</div>
                        <div class="jp-key wide">Ctrl</div>
                    </div>
                </div>
                <div id="katakanaKeyboard" style="display: none;">
                    <div class="jp-keyboard-row">
                        <div class="jp-key" onclick="insertJapaneseChar('ロ')"><span class="sub">1</span>ロ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ヌ')"><span class="sub">2</span>ヌ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('フ')"><span class="sub">3</span>フ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ア')"><span class="sub">4</span>ア</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ウ')"><span class="sub">5</span>ウ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('エ')"><span class="sub">6</span>エ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('オ')"><span class="sub">7</span>オ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ヤ')"><span class="sub">8</span>ヤ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ユ')"><span class="sub">9</span>ユ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ヨ')"><span class="sub">0</span>ヨ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ワ')"><span class="sub">-</span>ワ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ホ')"><span class="sub">=</span>ホ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ヘ')"><span class="sub">\</span>ヘ</div>
                        <div class="jp-key wide">Backspace</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key wide">Tab</div>
                        <div class="jp-key" onclick="insertJapaneseChar('タ')"><span class="sub">q</span>タ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('テ')"><span class="sub">w</span>テ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('イ')"><span class="sub">e</span>イ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ス')"><span class="sub">r</span>ス</div>
                        <div class="jp-key" onclick="insertJapaneseChar('カ')"><span class="sub">t</span>カ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ン')"><span class="sub">y</span>ン</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ナ')"><span class="sub">u</span>ナ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ニ')"><span class="sub">i</span>ニ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ラ')"><span class="sub">o</span>ラ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('セ')"><span class="sub">p</span>セ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('゛')"><span class="sub">[</span>゛</div>
                        <div class="jp-key" onclick="insertJapaneseChar('゜')"><span class="sub">]</span>゜</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ム')">ム</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key extra-wide">Caps Lock</div>
                        <div class="jp-key" onclick="insertJapaneseChar('チ')"><span class="sub">a</span>チ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ト')"><span class="sub">s</span>ト</div>
                        <div class="jp-key" onclick="insertJapaneseChar('シ')"><span class="sub">d</span>シ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ハ')"><span class="sub">f</span>ハ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('キ')"><span class="sub">g</span>キ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ク')"><span class="sub">h</span>ク</div>
                        <div class="jp-key" onclick="insertJapaneseChar('マ')"><span class="sub">j</span>マ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ノ')"><span class="sub">k</span>ノ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('リ')"><span class="sub">l</span>リ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('レ')"><span class="sub">;</span>レ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ケ')"><span class="sub">'</span>ケ</div>
                        <div class="jp-key extra-wide">Enter</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key extra-wide">Shift</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ツ')"><span class="sub">z</span>ツ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('サ')"><span class="sub">x</span>サ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ソ')"><span class="sub">c</span>ソ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ヒ')"><span class="sub">v</span>ヒ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('コ')"><span class="sub">b</span>コ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ミ')"><span class="sub">n</span>ミ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('モ')"><span class="sub">m</span>モ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ネ')"><span class="sub">,</span>ネ</div>
                        <div class="jp-key" onclick="insertJapaneseChar('ル')"><span class="sub">.</span>ル</div>
                        <div class="jp-key" onclick="insertJapaneseChar('メ')"><span class="sub">/</span>メ</div>
                        <div class="jp-key extra-wide">Shift</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key">A/あ</div>
                        <div class="jp-key wide">Alt</div>
                        <div class="jp-key space" onclick="insertJapaneseChar(' ')">Space</div>
                        <div class="jp-key wide">Alt</div>
                        <div class="jp-key wide">Ctrl</div>
                    </div>
                </div>
                <div id="englishKeyboard" style="display: none;">
                    <div class="jp-keyboard-row">
                        <div class="jp-key" onclick="insertJapaneseChar('`')"><span class="sub">~</span>`</div>
                        <div class="jp-key" onclick="insertJapaneseChar('1')"><span class="sub">!</span>1</div>
                        <div class="jp-key" onclick="insertJapaneseChar('2')"><span class="sub">@</span>2</div>
                        <div class="jp-key" onclick="insertJapaneseChar('3')"><span class="sub">#</span>3</div>
                        <div class="jp-key" onclick="insertJapaneseChar('4')"><span class="sub">$</span>4</div>
                        <div class="jp-key" onclick="insertJapaneseChar('5')"><span class="sub">%</span>5</div>
                        <div class="jp-key" onclick="insertJapaneseChar('6')"><span class="sub">^</span>6</div>
                        <div class="jp-key" onclick="insertJapaneseChar('7')"><span class="sub">&</span>7</div>
                        <div class="jp-key" onclick="insertJapaneseChar('8')"><span class="sub">*</span>8</div>
                        <div class="jp-key" onclick="insertJapaneseChar('9')"><span class="sub">(</span>9</div>
                        <div class="jp-key" onclick="insertJapaneseChar('0')"><span class="sub">)</span>0</div>
                        <div class="jp-key" onclick="insertJapaneseChar('-')"><span class="sub">_</span>-</div>
                        <div class="jp-key" onclick="insertJapaneseChar('=')"><span class="sub">+</span>=</div>
                        <div class="jp-key wide">Backspace</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key wide">Tab</div>
                        <div class="jp-key" onclick="insertJapaneseChar('q')">q</div>
                        <div class="jp-key" onclick="insertJapaneseChar('w')">w</div>
                        <div class="jp-key" onclick="insertJapaneseChar('e')">e</div>
                        <div class="jp-key" onclick="insertJapaneseChar('r')">r</div>
                        <div class="jp-key" onclick="insertJapaneseChar('t')">t</div>
                        <div class="jp-key" onclick="insertJapaneseChar('y')">y</div>
                        <div class="jp-key" onclick="insertJapaneseChar('u')">u</div>
                        <div class="jp-key" onclick="insertJapaneseChar('i')">i</div>
                        <div class="jp-key" onclick="insertJapaneseChar('o')">o</div>
                        <div class="jp-key" onclick="insertJapaneseChar('p')">p</div>
                        <div class="jp-key" onclick="insertJapaneseChar('[')"><span class="sub">{</span>[</div>
                        <div class="jp-key" onclick="insertJapaneseChar(']')"><span class="sub">}</span>]</div>
                        <div class="jp-key" onclick="insertJapaneseChar('\\')">\</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key extra-wide">Caps Lock</div>
                        <div class="jp-key" onclick="insertJapaneseChar('a')">a</div>
                        <div class="jp-key" onclick="insertJapaneseChar('s')">s</div>
                        <div class="jp-key" onclick="insertJapaneseChar('d')">d</div>
                        <div class="jp-key" onclick="insertJapaneseChar('f')">f</div>
                        <div class="jp-key" onclick="insertJapaneseChar('g')">g</div>
                        <div class="jp-key" onclick="insertJapaneseChar('h')">h</div>
                        <div class="jp-key" onclick="insertJapaneseChar('j')">j</div>
                        <div class="jp-key" onclick="insertJapaneseChar('k')">k</div>
                        <div class="jp-key" onclick="insertJapaneseChar('l')">l</div>
                        <div class="jp-key" onclick="insertJapaneseChar(';')"><span class="sub">:</span>;</div>
                        <div class="jp-key" onclick="insertJapaneseChar("'")"><span class="sub">"</span>'</div>
                        <div class="jp-key extra-wide">Enter</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key extra-wide">Shift</div>
                        <div class="jp-key" onclick="insertJapaneseChar('z')">z</div>
                        <div class="jp-key" onclick="insertJapaneseChar('x')">x</div>
                        <div class="jp-key" onclick="insertJapaneseChar('c')">c</div>
                        <div class="jp-key" onclick="insertJapaneseChar('v')">v</div>
                        <div class="jp-key" onclick="insertJapaneseChar('b')">b</div>
                        <div class="jp-key" onclick="insertJapaneseChar('n')">n</div>
                        <div class="jp-key" onclick="insertJapaneseChar('m')">m</div>
                        <div class="jp-key" onclick="insertJapaneseChar(',')"><span class="sub"><</span>,</div>
                        <div class="jp-key" onclick="insertJapaneseChar('.')"><span class="sub">></span>.</div>
                        <div class="jp-key" onclick="insertJapaneseChar('/')"><span class="sub">?</span>/</div>
                        <div class="jp-key extra-wide">Shift</div>
                    </div>
                    <div class="jp-keyboard-row">
                        <div class="jp-key">A/あ</div>
                        <div class="jp-key wide">Alt</div>
                        <div class="jp-key space" onclick="insertJapaneseChar(' ')">Space</div>
                        <div class="jp-key wide">Alt</div>
                        <div class="jp-key wide">Ctrl</div>
                    </div>
                </div>
                <div class="jp-keyboard-modes">
                    <label class="jp-keyboard-mode">
                        <input type="radio" name="keyboard-mode" value="hiragana" checked onclick="switchKeyboardMode('hiragana')">
                        <span>平假名</span>
                    </label>
                    <label class="jp-keyboard-mode">
                        <input type="radio" name="keyboard-mode" value="katakana" onclick="switchKeyboardMode('katakana')">
                        <span>片假名</span>
                    </label>
                    <label class="jp-keyboard-mode">
                        <input type="radio" name="keyboard-mode" value="english" onclick="switchKeyboardMode('english')">
                        <span>英文</span>
                    </label>
                </div>
            </div>
            <textarea id="content" placeholder="写下你的想法..."></textarea>
            <button type="submit">发布想法</button>
        </section>

        <section class="ideas-section">
            <h2>最新想法</h2>
            <div id="ideasList"></div>
        </section>
    </main>
</div>

<script>
    const GITHUB_CONFIG = {
        owner: 'imataw',
        repo: 'log'
    };
    let config = JSON.parse(localStorage.getItem('github_config') || '{}');
    const tokenExpireKey = 'token_expire_time';

    // 检查token是否过期
    function checkTokenExpired() {
        const expireTime = localStorage.getItem(tokenExpireKey);
        if (expireTime && new Date().getTime() > parseInt(expireTime)) {
            localStorage.removeItem('github_config');
            localStorage.removeItem(tokenExpireKey);
            config = {};
            return true;
        }
        return false;
    }

    // 显示/隐藏设置面板
    function toggleSettings() {
        const settingsSection = document.getElementById('settingsSection');
        settingsSection.classList.toggle('visible');
    }

    // 保存token和配置
    function saveToken() {
        const token = document.getElementById('githubToken').value.trim();
        const expireDays = parseInt(document.getElementById('tokenExpiration').value) || 1;

        if (!token) {
            showTokenStatus('请输入 Token', false);
            return;
        }

        if (expireDays < 1) {
            showTokenStatus('过期时间必须大于 0 分钟', false);
            return;
        }

        config = { 
            ...GITHUB_CONFIG,
            token
        };
        localStorage.setItem('github_config', JSON.stringify(config));
        
        // 设置过期时间
        const expireTime = new Date().getTime() + (expireDays * 60 * 1000);
        localStorage.setItem(tokenExpireKey, expireTime.toString());

        showTokenStatus('设置已保存', true);
        document.getElementById('settingsSection').classList.remove('visible');
        loadIdeas();
    }

    function showTokenStatus(message, isSuccess) {
        const status = document.getElementById('tokenStatus');
        status.textContent = message;
        status.className = 'status ' + (isSuccess ? 'success' : 'error');
    }

    document.addEventListener('DOMContentLoaded', () => {
        const ideaForm = document.getElementById('ideaForm');
        const ideasList = document.getElementById('ideasList');
        let ideas = [];
        let currentSha = '';

        // 填充已保存的配置
        if (config.token && !checkTokenExpired()) {
            document.getElementById('githubToken').value = config.token;
            loadIdeas();
        }
        
        // 从GitHub加载想法
        async function loadIdeas() {
            if (!config.token) return;

            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/ideas.json`, {
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.status === 404) {
                    // 文件不存在时初始化为空数组
                    ideas = [];
                    currentSha = '';
                    displayIdeas();
                    return;
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    if (response.status === 401) {
                        showTokenStatus('Token无效或已过期', false);
                    } else {
                        showTokenStatus(`加载失败: ${errorData.message}`, false);
                    }
                    return;
                }

                const data = await response.json();
                currentSha = data.sha;
                const content = base64ToUtf8(data.content);
                ideas = JSON.parse(content);
                displayIdeas();
            } catch (error) {
                console.error('加载想法失败:', error);
                showTokenStatus('加载失败，请检查网络连接', false);
            }
        }
        
        // 显示想法
        function displayIdeas() {
            ideasList.innerHTML = '';
            ideas.forEach(idea => {
                const ideaCard = document.createElement('div');
                ideaCard.className = 'idea-card';
                ideaCard.innerHTML = `
                    <p>${idea.content}</p>
                    <div class="timestamp">${idea.timestamp}</div>
                `;
                ideasList.prepend(ideaCard);
            });
        }
        
        // 保存想法到GitHub
        async function saveIdeas() {
            if (!config.token) {
                showTokenStatus('请先设置 Token', false);
                return;
            }

            try {
                console.log('正在保存到仓库:', `${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`);
                const content = utf8ToBase64(JSON.stringify(ideas, null, 2));
                console.log('准备发送请求...');
                
                // 构建请求体
                const requestBody = {
                    message: '更新想法',
                    content: content
                };
                
                // 只有在更新文件时才需要 sha
                if (currentSha) {
                    requestBody.sha = currentSha;
                }

                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/ideas.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                console.log('GitHub API 响应状态:', response.status);
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('GitHub API 错误详情:', errorData);
                    if (response.status === 401) {
                        showTokenStatus('Token 无效或已过期，请重新设置', false);
                        localStorage.removeItem('github_config');
                        localStorage.removeItem(tokenExpireKey);
                        config = {};
                    } else if (response.status === 404) {
                        showTokenStatus('找不到仓库，请确认仓库名称是否正确', false);
                    } else {
                        showTokenStatus(`保存失败: ${errorData.message}`, false);
                    }
                    return;
                }

                const data = await response.json();
                currentSha = data.content.sha;
                showTokenStatus('保存成功！', true);
            } catch (error) {
                console.error('保存想法失败:', error);
                showTokenStatus(`保存失败: ${error.message}`, false);
            }
        }
        
        // 处理表单提交
        ideaForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const content = document.getElementById('content').value;
            
            // 创建新想法对象
            const newIdea = {
                content: content,
                timestamp: new Date().toLocaleString('zh-CN')
            };
            
            // 添加到想法数组
            ideas.push(newIdea);
            
            // 保存到GitHub
            await saveIdeas();
            
            // 更新显示
            displayIdeas();
            
            // 重置表单
            ideaForm.reset();
        });
    });

    // 主题切换功能
    function toggleTheme() {
        const body = document.body;
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? '' : 'dark';
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
    }

    function updateThemeIcon(theme) {
        const sunIcon = document.querySelector('.sun-icon');
        const moonIcon = document.querySelector('.moon-icon');
        if (theme === 'dark') {
            sunIcon.style.display = 'none';
            moonIcon.style.display = 'block';
        } else {
            sunIcon.style.display = 'block';
            moonIcon.style.display = 'none';
        }
    }

    // 初始化主题
    const savedTheme = localStorage.getItem('theme') || '';
    document.body.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);

    // 初始化设置
    function initializeSettings() {
        const savedToken = localStorage.getItem('githubToken');
        const tokenInput = document.getElementById('githubToken');
        const expirationInput = document.getElementById('tokenExpiration');
        
        if (savedToken) {
            tokenInput.value = savedToken;
            // 解析token并获取过期时间
            try {
                const tokenParts = savedToken.split('.');
                if (tokenParts.length === 3) {
                    const payload = JSON.parse(atob(tokenParts[1]));
                    if (payload.exp) {
                        const expirationDate = new Date(payload.exp * 1000);
                        const now = new Date();
                        const minutesUntilExpiration = Math.floor((expirationDate - now) / 60000);
                        if (minutesUntilExpiration > 0) {
                            expirationInput.value = minutesUntilExpiration;
                        }
                    }
                }
            } catch (e) {
                console.error('Error parsing token:', e);
            }
        }

        // 设置密码显示切换
        const toggleButton = document.querySelector('.toggle-password');
        const eyeOpen = document.querySelector('.eye-open');
        const eyeClosed = document.querySelector('.eye-closed');
        
        toggleButton.addEventListener('click', function() {
            const input = document.getElementById('githubToken');
            if (input.type === 'password') {
                input.type = 'text';
                eyeOpen.style.display = 'none';
                eyeClosed.style.display = 'block';
            } else {
                input.type = 'password';
                eyeOpen.style.display = 'block';
                eyeClosed.style.display = 'none';
            }
        });
    }

    // 在页面加载时初始化设置
    document.addEventListener('DOMContentLoaded', function() {
        initializeSettings();
    });

    // 日语键盘功能
    let jpKeyboardVisible = false;

    function toggleJapaneseKeyboard() {
        const keyboard = document.querySelector('.jp-keyboard');
        jpKeyboardVisible = !jpKeyboardVisible;
        keyboard.style.display = jpKeyboardVisible ? 'block' : 'none';
    }

    function switchKeyboardMode(mode) {
        const hiragana = document.getElementById('hiraganaKeyboard');
        const katakana = document.getElementById('katakanaKeyboard');
        const english = document.getElementById('englishKeyboard');
        
        hiragana.style.display = mode === 'hiragana' ? 'block' : 'none';
        katakana.style.display = mode === 'katakana' ? 'block' : 'none';
        english.style.display = mode === 'english' ? 'block' : 'none';
    }

    function insertJapaneseChar(char) {
        const ideaInput = document.getElementById('content');
        const start = ideaInput.selectionStart;
        const end = ideaInput.selectionEnd;
        const text = ideaInput.value;
        ideaInput.value = text.substring(0, start) + char + text.substring(end);
        ideaInput.selectionStart = ideaInput.selectionEnd = start + char.length;
        ideaInput.focus();
    }

    // 点击文本区域外时隐藏键盘
    document.addEventListener('click', function(event) {
        const keyboard = document.querySelector('.jp-keyboard');
        if (jpKeyboardVisible && 
            !event.target.closest('.jp-keyboard') && 
            !event.target.closest('.jp-keyboard-btn') && 
            !event.target.closest('#content')) {
            jpKeyboardVisible = false;
            keyboard.style.display = 'none';
        }
    });

    // Base64 编码，支持中文
    function utf8ToBase64(str) {
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
            function toSolidBytes(match, p1) {
                return String.fromCharCode('0x' + p1);
            }));
    }

    // Base64 解码，支持中文
    function base64ToUtf8(str) {
        return decodeURIComponent(atob(str).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
    }
</script>
</body>
</html>
